---
title: "Water Quality"
date: "2022-10-26"
author: "J. Brentrup"
output: html_notebook
editor_options: 
  chunk_output_type: console
---

# Load Libraries
```{r, message=FALSE}

# install.packages("tidyverse")

library(tidyverse)
library(googledrive)
library(readxl)
library(lubridate)
```

# Load data- water quality May-Sep
```{r}
wq_data <- read_csv("Data/WaterQuality/combined_lab_field_may_sep.csv")
  str(wq_data)
  
unique(wq_data$Site)
```

# Burn severity gradient vs. TP - May
```{r}

attribute_data <- read_csv("Data/attribute_data.csv")

lake_depth <- read_csv("Data/lake_depth.csv")

mayWQ_fire <-  mayWQ_fire %>% 
  select(-Site.y) %>% 
  rename(Site = Site.x)

mayWQ_fire_v2 <- left_join(mayWQ_fire, attribute_data, by = "lagoslakeid")

mayWQ_fire_v3 <- left_join(mayWQ_fire_v2, LAGOStable, by = "lagoslakeid") %>% 
  select(LakeName, ws_lake_arearatio, lake_waterarea_ha.x, ws_area_ha.y)

summary(mayWQ_fire)

ggplot(data=mayWQ_fire_v3, aes(x=ws_vbs_High_pct, y=logTP, color=ws_lake_arearatio, label=LakeName))+ #ws_lake_arearatio
  #ggtitle('May total phosphorus')+
  geom_point(size=4)+ 
  geom_text(hjust=0, vjust=0, size=5, nudge_x=1)+
  #geom_smooth()+ #separate lines for isolated and drainage
  #geom_abline(slope = coef(plotlm)[2], 
  #            intercept = coef(plotlm)[["(Intercept)"]])+
  geom_vline(xintercept=25, linetype='dashed')+
  #annotate(geom="text", x=5, y=4, label=paste0("r=",rval),
  #         color="red")+
  #annotate(geom="text", x=5, y=3.8, label=paste0("p=",pval),
  #         color="red")+
  theme_classic()+
  scale_x_continuous(limits=c(0,100), name='Watershed High Severity Burn (%)')+
  scale_y_continuous(limits=c(2.5,4), name='log(Total Phosphorus) (ppb)')+
 labs(color = "Watershead Area: \n Lake Area")+
   theme(axis.title.x = element_text(size=24),
              axis.title.y = element_text(size=24),
              axis.text.y = element_text(size=22, color="black",margin = margin(l=10,r=5, unit = "pt")),
              axis.text.x = element_text(size=22, color="black",margin = margin(b=10,t=5, unit = "pt")),
              legend.title = element_text(size = 24),
              #legend.position = "top", #c(0.77,0.83)  
              legend.text = element_text(size=20,color="black", margin = margin(r=7,l=5, unit = "pt")))+
        theme(axis.ticks.length = unit(.2, "cm"),
              legend.position=c(0.8,0.2)) +
 # scale_color_stepsn(n.breaks = 7, colours = terrain.colors(7)) +
  scale_color_binned(type = "viridis")+ #, breaks = levels(mayWQ_fire_v3$ws_lake_arearatio))
  guides(colour = guide_coloursteps(show.limits = TRUE, even.steps = F))

  scale_color_manual("Class", values=c('black','firebrick'), labels=c('Drainage','Isolated'))
  
  ggsave("~/Documents/RAPID Fire Grant/GLEON Poster/logTP_WatershedBurn.pdf", width = 11, height = 8.5, useDingbats=FALSE, dpi = 600)
```

# TP vs. TN

```{r}
# N:P ratio
may_thru_sep <- may_thru_sep %>% 
  mutate(N_P_ratio = TN_ppb/TP_ppb) %>% 
  mutate(TP_microMolar = TP_ppb/31) %>% 
    mutate(TN_microMolar = TN_ppb/14)

mod <- lm(TN_ppb ~ TP_ppb, data = may_thru_sep)

mod2 <- lm(logTN ~ logTP, data = may_thru_sep)
summary(mod)
coef(mod)

ggplot(data=may_thru_sep, aes(x=logTP, y=logTN, color=Month_factor, shape=Group))+
  geom_abline(slope = 0.49, intercept = 5.05)+
  #geom_abline(slope = 1, intercept = 0, size=2, linetype =2)+ #1:1 line
  geom_point(size=4)+
  # xlim(2,8)+
  # ylim(2,8)+
  theme_classic()

ggplot(data=may_thru_sep, aes(x=TP_microMolar, y=TN_microMolar, color=Group, shape=Group))+
  #geom_abline(slope = 0.49, intercept = 5.05)+
 # geom_abline(slope = 1, intercept = 0, size=2, linetype =2)+ #1:1 line
  geom_point(size=6, stroke = 1, alpha = 0.85)+
  xlim(0,2)+
  ylim(0,100)+
  scale_color_manual(values = c("red", "red", "navyblue", "navyblue"))+
  scale_shape_manual(values = c(1, 16,1,16))+
  labs(color = "Lake Type", shape = "Lake Type",x = "Total Phosphorus (µM)", y = "Total Nitrogen (µM)")+
  theme_classic()+
  theme(axis.title.x = element_text(size=22),
              axis.title.y = element_text(size=22),
              axis.text.y = element_text(size=18, color="black",margin = margin(l=10,r=5, unit = "pt")),
              axis.text.x = element_text(size=18, color="black",margin = margin(b=10,t=5, unit = "pt")),
              legend.title = element_text(size = 22),
              #legend.position = "top", #c(0.77,0.83)  
              legend.text = element_text(size=18,color="black", margin = margin(r=7,l=5, unit = "pt")))+
        theme(axis.ticks.length = unit(.2, "cm"),
              legend.position=c(0.8,0.2))

 ggsave("~/Documents/RAPID Fire Grant/GLEON Poster/TN_v_TP.pdf", width = 11, height = 8.5, useDingbats=FALSE, dpi = 600)
 



```

#Boxplots for all water chem
```{r}
library(khroma)
sunset <- colour("sunset")
sunset(9)

#month_colors <- c('dodgerblue','tan','gold','orange','darkgreen')
#month_colors <- c("#364B9A", "#FFEE99", "#F99858", "#E34D34","#83B8D7" ) #red blue gradient
#month_colors <- c("#762A83", "#9970AB", "#C2A5CF", "#E7D4E8", "#DDDDDD") # purple gradient#F7F7F7
month_colors <- c("#bd0026", '#f03b20', "#fd8d3c", "#fecc5c", "#ffffb2") # red gradient

PRGn <- colour("PRGn")
PRGn(9)

iridescent <- colour("iridescent")
iridescent(23)

summary(allWQ_data)
#TP
ggplot(allWQ_data, aes(x = Group, y = TP_ppb, fill = Month_factor)) +
  geom_boxplot() + 
  theme_classic() +
  labs(x = "Lake Type", y = "Total Phosphorus (µg/L)")+
  scale_y_continuous(limits=c(0,50))+
  scale_fill_manual("Month", values=month_colors)+
  theme(axis.title.x = element_text(size=24),
              axis.title.y = element_text(size=24),
              axis.text.y = element_text(size=22, color="black",margin = margin(l=10,r=5, unit = "pt")),
              axis.text.x = element_text(size=20, color="black",margin = margin(b=10,t=5, unit = "pt")),
              legend.title = element_text(size = 24),
              #legend.position = "top", #c(0.77,0.83)  
              legend.text = element_text(size=20,color="black", margin = margin(r=7,l=5, unit = "pt")))+
        theme(axis.ticks.length = unit(.2, "cm"),
              legend.position=c(0.8,0.8))+
  scale_x_discrete(labels=c('Burned drainage','Burned isolated',
                            'Control drainage','Control isolated'))

 #ggsave("~/Documents/RAPID Fire Grant/GLEON Poster/TP_laketype.pdf", width = 11, height = 8.5, useDingbats=FALSE, dpi = 600)
 
#TN
ggplot(allWQ_data, aes(x = Group, y = TN_ppb, fill = Month_factor)) +
  geom_boxplot() + 
  theme_classic() +
  labs(x = "Lake Type", y = "Total Nitrogen (µg/L)")+
  scale_y_continuous(limits=c(200,1845), breaks=seq(200,1800,by=300))+
  scale_fill_manual("Month", values=month_colors, guide = NULL)+
  theme(axis.title.x = element_text(size=24),
              axis.title.y = element_text(size=24),
              axis.text.y = element_text(size=22, color="black",margin = margin(l=10,r=5, unit = "pt")),
              axis.text.x = element_text(size=20, color="black",margin = margin(b=10,t=5, unit = "pt")),
              legend.title = element_text(size = 24),
              #legend.position = "top", #c(0.77,0.83)  
              legend.text = element_text(size=20,color="black", margin = margin(r=7,l=5, unit = "pt")))+
        theme(axis.ticks.length = unit(.2, "cm"),
              legend.position=c(0.8,0.8))+
  scale_x_discrete(labels=c('Burned drainage','Burned isolated',
                            'Control drainage','Control isolated'))

 ggsave("~/Documents/RAPID Fire Grant/GLEON Poster/TN_laketype.pdf", width = 11, height = 8.5, useDingbats=FALSE, dpi = 600)
 
 #Chla
ggplot(allWQ_data, aes(x = Group, y = Chloro_ppb, fill = Month_factor)) +
  geom_boxplot() + 
  theme_classic() +
  labs(x = "Lake Type", y = "Chlorophyll-a (µg/L)")+
  scale_y_continuous(limits=c(0,25), breaks=seq(0,25,by=5))+
  scale_fill_manual("Month", values=month_colors, guide = NULL)+
  theme(axis.title.x = element_text(size=24),
              axis.title.y = element_text(size=24),
              axis.text.y = element_text(size=22, color="black",margin = margin(l=10,r=5, unit = "pt")),
              axis.text.x = element_text(size=20, color="black",margin = margin(b=10,t=5, unit = "pt")),
              legend.title = element_text(size = 24),
              #legend.position = "top", #c(0.77,0.83)  
              legend.text = element_text(size=20,color="black", margin = margin(r=7,l=5, unit = "pt")))+
        theme(axis.ticks.length = unit(.2, "cm"),
              legend.position=c(0.8,0.8))+
  scale_x_discrete(labels=c('Burned drainage','Burned isolated',
                            'Control drainage','Control isolated'))

 ggsave("~/Documents/RAPID Fire Grant/GLEON Poster/Chla_laketype.pdf", width = 11, height = 8.5, useDingbats=FALSE, dpi = 600)

 #DOC
ggplot(allWQ_data, aes(x = Group, y = DOC_ppm, fill = Month_factor)) +
  geom_boxplot() + 
  theme_classic() +
  labs(x = "Lake Type", y = "Dissolved Organic Carbon (mg/L)")+
  scale_y_continuous(limits=c(0,40), breaks=seq(0,40,by=10))+
  scale_fill_manual("Month", values=month_colors, guide = NULL)+
  theme(axis.title.x = element_text(size=24),
              axis.title.y = element_text(size=24),
              axis.text.y = element_text(size=22, color="black",margin = margin(l=10,r=5, unit = "pt")),
              axis.text.x = element_text(size=20, color="black",margin = margin(b=10,t=5, unit = "pt")),
              legend.title = element_text(size = 24),
              #legend.position = "top", #c(0.77,0.83)  
              legend.text = element_text(size=20,color="black", margin = margin(r=7,l=5, unit = "pt")))+
        theme(axis.ticks.length = unit(.2, "cm"),
              legend.position=c(0.8,0.8))+
  scale_x_discrete(labels=c('Burned drainage','Burned isolated',
                            'Control drainage','Control isolated'))

 ggsave("~/Documents/RAPID Fire Grant/GLEON Poster/DOC_laketype.pdf", width = 11, height = 8.5, useDingbats=FALSE, dpi = 600)

 
 #TSS
ggplot(allWQ_data, aes(x = Group, y = TSS_mgL, fill = Month_factor)) +
  geom_boxplot() + 
  theme_classic() +
  labs(x = "Lake Type", y = "Total Suspended Solids (mg/L)")+
  scale_y_continuous(limits=c(0,10), breaks=seq(0,10,by=2.5))+
  scale_fill_manual("Month", values=month_colors, guide = NULL)+
  theme(axis.title.x = element_text(size=24),
              axis.title.y = element_text(size=24),
              axis.text.y = element_text(size=22, color="black",margin = margin(l=10,r=5, unit = "pt")),
              axis.text.x = element_text(size=20, color="black",margin = margin(b=10,t=5, unit = "pt")),
              legend.title = element_text(size = 24),
              #legend.position = "top", #c(0.77,0.83)  
              legend.text = element_text(size=20,color="black", margin = margin(r=7,l=5, unit = "pt")))+
        theme(axis.ticks.length = unit(.2, "cm"),
              legend.position=c(0.8,0.8))+
  scale_x_discrete(labels=c('Burned drainage','Burned isolated',
                            'Control drainage','Control isolated'))

 ggsave("~/Documents/RAPID Fire Grant/GLEON Poster/TSS_laketype.pdf", width = 11, height = 8.5, useDingbats=FALSE, dpi = 600)
 
 #Secchi
ggplot(allWQ_data, aes(x = Group, y = SecchiDepth_m, fill = Month_factor)) +
  geom_boxplot() + 
  theme_classic() +
  labs(x = "Lake Type", y = "Secchi Depth (m)")+
  scale_y_continuous(limits=c(0,4), breaks=seq(0,4,by=1))+
  scale_fill_manual("Month", values=month_colors, guide = NULL)+
  theme(axis.title.x = element_text(size=24),
              axis.title.y = element_text(size=24),
              axis.text.y = element_text(size=22, color="black",margin = margin(l=10,r=5, unit = "pt")),
              axis.text.x = element_text(size=20, color="black",margin = margin(b=10,t=5, unit = "pt")),
              legend.title = element_text(size = 24),
              #legend.position = "top", #c(0.77,0.83)  
              legend.text = element_text(size=20,color="black", margin = margin(r=7,l=5, unit = "pt")))+
        theme(axis.ticks.length = unit(.2, "cm"),
              legend.position=c(0.8,0.8))+
  scale_x_discrete(labels=c('Burned drainage','Burned isolated',
                            'Control drainage','Control isolated'))

 ggsave("~/Documents/RAPID Fire Grant/GLEON Poster/Secchi_laketype.pdf", width = 11, height = 8.5, useDingbats=FALSE, dpi = 600)

 
```


#DOC vs. Chla
```{r}
sep_doc_chla <- allWQ_data %>% 
  filter(Month == 9)

ggplot(sep_doc_chla, aes(x = DOC_ppm, y = Chloro_ppb, color = Group, shape = Group))+
  geom_point(size = 6, stroke = 1)+
  theme_classic()+
  scale_color_manual(values = c("red", "red", "navyblue", "navyblue"), labels=c('Burned drainage','Burned isolated','Control drainage','Control isolated'))+
  scale_shape_manual(values = c(16, 1,16,1), labels=c('Burned drainage','Burned isolated','Control drainage','Control isolated'))+
   xlim(0,40)+
  ylim(0,25.1)+
  labs(color = NULL, shape = NULL,x = "DOC (mg/L)", y = "Chlorophyll-a (µg/L)")+
  theme(axis.title.x = element_text(size=24),
              axis.title.y = element_text(size=24),
              axis.text.y = element_text(size=20, color="black",margin = margin(l=10,r=5, unit = "pt")),
              axis.text.x = element_text(size=20, color="black",margin = margin(b=10,t=5, unit = "pt")),
              legend.title = element_text(size = 24),
              #legend.position = "top", #c(0.77,0.83)  
              legend.text = element_text(size=20,color="black", margin = margin(r=7,l=5, unit = "pt")))+
        theme(axis.ticks.length = unit(.2, "cm"),legend.position=c(0.85,0.9))

ggsave("~/Documents/RAPID Fire Grant/GLEON Poster/DOC_v_Chla.pdf", width = 11, height = 8.5, useDingbats=FALSE, dpi = 600)
 
```

# Burn severity by lake
```{r}

ws_burn_severity_pct_melted_order <- ws_burn_severity_pct_melted %>% 
  arrange(desc(Severity), desc(Percent))


str(ws_burn_severity_pct_melted_order)

unique(ws_burn_severity_pct_melted_order$Lake)

ws_burn_severity_pct_melted_order$Severity_fac <- factor(ws_burn_severity_pct_melted_order$Severity, levels = c("Unburned_pct","Low_pct","ModerateLow_pct","ModerateHigh_pct", "High_pct"))

# Order lakes by high severity burn
ws_burn_severity_pct_melted_order$Lake_fac <- factor(ws_burn_severity_pct_melted_order$Lake, levels = c("Fourth McDougal", "Middle McDougal", "North McDougal" , "South McDougal" , "Stony ", "Fishtrap " ,     
  "Wampus ",  "Sand " , "Greenwood ", " Gegoka" , "Slate "  ,"West Chub " , "Teamster " , "Unnamed ", "Lil Chub "      ))

ggplot(ws_burn_severity_pct_melted_order, aes(x=Lake_fac, y = Percent, fill=Severity_fac))+ ##,  )) + 
  geom_bar(position="stack", stat="identity")+
  theme_classic()+
  #coord_flip()+
  #theme(axis.text.x=element_text(angle=90, vjust=0.5, hjust=1, color='black'),
      #  axis.text.y=element_text(color='black'))+
  theme(axis.title.x = element_text(size=24),
              axis.title.y = element_text(size=24),
              axis.text.y = element_text(size=22, color="black",margin = margin(l=10,r=5, unit = "pt")),
              axis.text.x = element_text(angle=50, vjust=0.75, hjust=0.5, size=20, color="black"),
              legend.title = element_text(size = 24),
              #legend.position = "top", #c(0.77,0.83)  
              legend.text = element_text(size=20,color="black"))+ #, margin = margin(r=7,l=5, unit = "pt")))+
        theme(axis.ticks.length = unit(.2, "cm"))+ #,
              #legend.position=c(0.8,0.8))+
  scale_fill_manual(values=c('gray90','gold','orange','firebrick','black'), 
                    labels=c('Unburned','Low','Low-Moderate','Moderate-High','High'),
                    'Severity (%)')+
  labs(y = 'Watershed Vegetation Burn Severity (%)', x = "Lake")

ggsave("~/Documents/RAPID Fire Grant/GLEON Poster/WatershedBurnSeverity.pdf", width = 11, height = 8.5, useDingbats=FALSE, dpi = 600)
```

