---
title: "WaterQuality_PercentChange"
author: "Ian McCullough"
date: "2022-11-17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#### R libraries ####
library(dplyr)
library(ggplot2)

#### Input data ####
setwd("C:/Users/immcc/Documents/SplashNBurn")

# water quality
waterquality <- read.csv("Data/WaterQuality/combined_lab_field_may_sep.csv")

#### Main program ####
month_order <- c('May','Jun','Jul','Aug','Sep')
common_y_limits <- c(-100,250)
common_y_breaks <- seq(-100,250,25)

```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
# Percent change in water quality between burned and control lakes
# for each month from May to September 2022
# this version shows standardized y axes
# all metrics taken at the surface
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
## TP
TP <- waterquality[,c('TP_ppb','Month_factor','Type')]
TP_burned <- subset(TP, Type=='Burned')
TP_control <- subset(TP, Type=='Control')

TP_byMonth_burned <- TP_burned %>%
  group_by(Month_factor) %>%
  summarize(TP_MedianBurned=median(TP_ppb, na.rm=T))

TP_byMonth_control <- TP_control %>%
  group_by(Month_factor) %>%
  summarize(TP_MedianControl=median(TP_ppb, na.rm=T))

TP_byMonth <- merge(TP_byMonth_burned, TP_byMonth_control, by='Month_factor', all=T)
TP_byMonth <- TP_byMonth %>%
  mutate(Month_factor =  factor(Month_factor, levels = month_order)) %>%
  arrange(Month_factor)
TP_byMonth$TP_MedianDiff <- ((TP_byMonth$TP_MedianBurned - TP_byMonth$TP_MedianControl)/TP_byMonth$TP_MedianControl)*100

# basic plot
ggplot(TP_byMonth, aes(x=Month_factor, y=TP_MedianDiff))+
  geom_bar(stat='identity', fill='firebrick')+
  theme_classic()+
  scale_y_continuous('Percent difference',limits=common_y_limits, breaks=common_y_breaks)+
  scale_x_discrete('Month')+
  theme(axis.title.y=element_text(color='black'),
        axis.title.x=element_text(color='black'),
        axis.text.y=element_text(color='black'),
        axis.text.x=element_text(color='black'))+
  ggtitle('Total phosphorus')+
  geom_hline(yintercept = 0, linetype='dashed')


## TN
TN <- waterquality[,c('TN_ppb','Month_factor','Type')]
TN_burned <- subset(TN, Type=='Burned')
TN_control <- subset(TN, Type=='Control')

TN_byMonth_burned <- TN_burned %>%
  group_by(Month_factor) %>%
  summarize(TN_MedianBurned=median(TN_ppb, na.rm=T))

TN_byMonth_control <- TN_control %>%
  group_by(Month_factor) %>%
  summarize(TN_MedianControl=median(TN_ppb, na.rm=T))

TN_byMonth <- merge(TN_byMonth_burned, TN_byMonth_control, by='Month_factor', all=T)
TN_byMonth <- TN_byMonth %>%
  mutate(Month_factor =  factor(Month_factor, levels = month_order)) %>%
  arrange(Month_factor)
TN_byMonth$TN_MedianDiff <- ((TN_byMonth$TN_MedianBurned - TN_byMonth$TN_MedianControl)/TN_byMonth$TN_MedianControl)*100

# basic plot
ggplot(TN_byMonth, aes(x=Month_factor, y=TN_MedianDiff))+
  geom_bar(stat='identity', fill='firebrick')+
  theme_classic()+
  scale_y_continuous('Percent difference',limits=common_y_limits, breaks=common_y_breaks)+
  scale_x_discrete('Month')+
  theme(axis.title.y=element_text(color='black'),
        axis.title.x=element_text(color='black'),
        axis.text.y=element_text(color='black'),
        axis.text.x=element_text(color='black'))+
  ggtitle('Total nitrogen')+
  geom_hline(yintercept = 0, linetype='dashed')


# ## NO2NO3 # why so many 0s?
# NO2NO3 <- waterquality[,c('NO2NO3_ppb','Month_factor','Type')]
# NO2NO3_burned <- subset(NO2NO3, Type=='Burned')
# NO2NO3_control <- subset(NO2NO3, Type=='Control')
# 
# NO2NO3_byMonth_burned <- NO2NO3_burned %>%
#   group_by(Month_factor) %>%
#   summarize(NO2NO3_MedianBurned=median(NO2NO3_ppb, na.rm=T))
# 
# NO2NO3_byMonth_control <- NO2NO3_control %>%
#   group_by(Month_factor) %>%
#   summarize(NO2NO3_MedianControl=median(NO2NO3_ppb, na.rm=T))
# 
# NO2NO3_byMonth <- merge(NO2NO3_byMonth_burned, NO2NO3_byMonth_control, by='Month_factor', all=T)
# NO2NO3_byMonth <- NO2NO3_byMonth %>%
#   mutate(Month_factor =  factor(Month_factor, levels = month_order)) %>%
#   arrange(Month_factor)
# NO2NO3_byMonth$NO2NO3_MedianDiff <- ((NO2NO3_byMonth$NO2NO3_MedianBurned - NO2NO3_byMonth$NO2NO3_MedianControl)/NO2NO3_byMonth$NO2NO3_MedianControl)*100
# 
# # basic plot
# ggplot(NO2NO3_byMonth, aes(x=Month_factor, y=NO2NO3_MedianDiff))+
#   geom_bar(stat='identity', fill='firebrick')+
#   theme_classic()+
#   scale_y_continuous('Percent difference',limits=common_y_limits, breaks=common_y_breaks)+
#   scale_x_discrete('Month')+
#   theme(axis.title.y=element_text(color='black'),
#         axis.title.x=element_text(color='black'),
#         axis.text.y=element_text(color='black'),
#         axis.text.x=element_text(color='black'))+
#   ggtitle('NO2NO3')+
#   geom_hline(yintercept = 0, linetype='dashed')


## NH4N
NH4N <- waterquality[,c('NH4N_ppb','Month_factor','Type')]
NH4N_burned <- subset(NH4N, Type=='Burned')
NH4N_control <- subset(NH4N, Type=='Control')

NH4N_byMonth_burned <- NH4N_burned %>%
  group_by(Month_factor) %>%
  summarize(NH4N_MedianBurned=median(NH4N_ppb, na.rm=T))

NH4N_byMonth_control <- NH4N_control %>%
  group_by(Month_factor) %>%
  summarize(NH4N_MedianControl=median(NH4N_ppb, na.rm=T))

NH4N_byMonth <- merge(NH4N_byMonth_burned, NH4N_byMonth_control, by='Month_factor', all=T)
NH4N_byMonth <- NH4N_byMonth %>%
  mutate(Month_factor =  factor(Month_factor, levels = month_order)) %>%
  arrange(Month_factor)
NH4N_byMonth$NH4N_MedianDiff <- ((NH4N_byMonth$NH4N_MedianBurned - NH4N_byMonth$NH4N_MedianControl)/NH4N_byMonth$NH4N_MedianControl)*100

# basic plot
ggplot(NH4N_byMonth, aes(x=Month_factor, y=NH4N_MedianDiff))+
  geom_bar(stat='identity', fill='firebrick')+
  theme_classic()+
  scale_y_continuous('Percent difference',limits=common_y_limits, breaks=common_y_breaks)+
  scale_x_discrete('Month')+
  theme(axis.title.y=element_text(color='black'),
        axis.title.x=element_text(color='black'),
        axis.text.y=element_text(color='black'),
        axis.text.x=element_text(color='black'))+
  ggtitle('NH4N')+
  geom_hline(yintercept = 0, linetype='dashed')

## DOC
DOC <- waterquality[,c('DOC_ppm','Month_factor','Type')]
DOC_burned <- subset(DOC, Type=='Burned')
DOC_control <- subset(DOC, Type=='Control')

DOC_byMonth_burned <- DOC_burned %>%
  group_by(Month_factor) %>%
  summarize(DOC_MedianBurned=median(DOC_ppm, na.rm=T))

DOC_byMonth_control <- DOC_control %>%
  group_by(Month_factor) %>%
  summarize(DOC_MedianControl=median(DOC_ppm, na.rm=T))

DOC_byMonth <- merge(DOC_byMonth_burned, DOC_byMonth_control, by='Month_factor', all=T)
DOC_byMonth <- DOC_byMonth %>%
  mutate(Month_factor =  factor(Month_factor, levels = month_order)) %>%
  arrange(Month_factor)
DOC_byMonth$DOC_MedianDiff <- ((DOC_byMonth$DOC_MedianBurned - DOC_byMonth$DOC_MedianControl)/DOC_byMonth$DOC_MedianControl)*100

# basic plot
ggplot(DOC_byMonth, aes(x=Month_factor, y=DOC_MedianDiff))+
  geom_bar(stat='identity', fill='firebrick')+
  theme_classic()+
  scale_y_continuous('Percent difference',limits=common_y_limits, breaks=common_y_breaks)+
  scale_x_discrete('Month')+
  theme(axis.title.y=element_text(color='black'),
        axis.title.x=element_text(color='black'),
        axis.text.y=element_text(color='black'),
        axis.text.x=element_text(color='black'))+
  ggtitle('Dissolved organic carbon')+
  geom_hline(yintercept = 0, linetype='dashed')

## TSS
TSS <- waterquality[,c('TSS_mgL','Month_factor','Type')]
TSS_burned <- subset(TSS, Type=='Burned')
TSS_control <- subset(TSS, Type=='Control')

TSS_byMonth_burned <- TSS_burned %>%
  group_by(Month_factor) %>%
  summarize(TSS_MedianBurned=median(TSS_mgL, na.rm=T))

TSS_byMonth_control <- TSS_control %>%
  group_by(Month_factor) %>%
  summarize(TSS_MedianControl=median(TSS_mgL, na.rm=T))

TSS_byMonth <- merge(TSS_byMonth_burned, TSS_byMonth_control, by='Month_factor', all=T)
TSS_byMonth <- TSS_byMonth %>%
  mutate(Month_factor =  factor(Month_factor, levels = month_order)) %>%
  arrange(Month_factor)
TSS_byMonth$TSS_MedianDiff <- ((TSS_byMonth$TSS_MedianBurned - TSS_byMonth$TSS_MedianControl)/TSS_byMonth$TSS_MedianControl)*100

# basic plot
ggplot(TSS_byMonth, aes(x=Month_factor, y=TSS_MedianDiff))+
  geom_bar(stat='identity', fill='firebrick')+
  theme_classic()+
  scale_y_continuous('Percent difference',limits=common_y_limits, breaks=common_y_breaks)+
  scale_x_discrete('Month')+
  theme(axis.title.y=element_text(color='black'),
        axis.title.x=element_text(color='black'),
        axis.text.y=element_text(color='black'),
        axis.text.x=element_text(color='black'))+
  ggtitle('Total suspended solids')+
  geom_hline(yintercept = 0, linetype='dashed')


## Chloro
Chloro <- waterquality[,c('Chloro_ppb','Month_factor','Type')]
Chloro_burned <- subset(Chloro, Type=='Burned')
Chloro_control <- subset(Chloro, Type=='Control')

Chloro_byMonth_burned <- Chloro_burned %>%
  group_by(Month_factor) %>%
  summarize(Chloro_MedianBurned=median(Chloro_ppb, na.rm=T))

Chloro_byMonth_control <- Chloro_control %>%
  group_by(Month_factor) %>%
  summarize(Chloro_MedianControl=median(Chloro_ppb, na.rm=T))

Chloro_byMonth <- merge(Chloro_byMonth_burned, Chloro_byMonth_control, by='Month_factor', all=T)
Chloro_byMonth <- Chloro_byMonth %>%
  mutate(Month_factor =  factor(Month_factor, levels = month_order)) %>%
  arrange(Month_factor)
Chloro_byMonth$Chloro_MedianDiff <- ((Chloro_byMonth$Chloro_MedianBurned - Chloro_byMonth$Chloro_MedianControl)/Chloro_byMonth$Chloro_MedianControl)*100

# basic plot
ggplot(Chloro_byMonth, aes(x=Month_factor, y=Chloro_MedianDiff))+
  geom_bar(stat='identity', fill='firebrick')+
  theme_classic()+
  scale_y_continuous('Percent difference',limits=common_y_limits, breaks=common_y_breaks)+
  scale_x_discrete('Month')+
  theme(axis.title.y=element_text(color='black'),
        axis.title.x=element_text(color='black'),
        axis.text.y=element_text(color='black'),
        axis.text.x=element_text(color='black'))+
  ggtitle('Chlorophyll-a')+
  geom_hline(yintercept = 0, linetype='dashed')


## Secchi
Secchi <- waterquality[,c('SecchiDepth_m','Month_factor','Type')]
Secchi_burned <- subset(Secchi, Type=='Burned')
Secchi_control <- subset(Secchi, Type=='Control')

Secchi_byMonth_burned <- Secchi_burned %>%
  group_by(Month_factor) %>%
  summarize(Secchi_MedianBurned=median(SecchiDepth_m, na.rm=T))

Secchi_byMonth_control <- Secchi_control %>%
  group_by(Month_factor) %>%
  summarize(Secchi_MedianControl=median(SecchiDepth_m, na.rm=T))

Secchi_byMonth <- merge(Secchi_byMonth_burned, Secchi_byMonth_control, by='Month_factor', all=T)
Secchi_byMonth <- Secchi_byMonth %>%
  mutate(Month_factor =  factor(Month_factor, levels = month_order)) %>%
  arrange(Month_factor)
Secchi_byMonth$Secchi_MedianDiff <- ((Secchi_byMonth$Secchi_MedianBurned - Secchi_byMonth$Secchi_MedianControl)/Secchi_byMonth$Secchi_MedianControl)*100

# basic plot
ggplot(Secchi_byMonth, aes(x=Month_factor, y=Secchi_MedianDiff))+
  geom_bar(stat='identity', fill='firebrick')+
  theme_classic()+
  scale_y_continuous('Percent difference',limits=common_y_limits, breaks=common_y_breaks)+
  scale_x_discrete('Month')+
  theme(axis.title.y=element_text(color='black'),
        axis.title.x=element_text(color='black'),
        axis.text.y=element_text(color='black'),
        axis.text.x=element_text(color='black'))+
  ggtitle('Secchi')+
  geom_hline(yintercept = 0, linetype='dashed')


## pH
pH <- waterquality[,c('pH','Month_factor','Type')]
pH_burned <- subset(pH, Type=='Burned')
pH_control <- subset(pH, Type=='Control')

pH_byMonth_burned <- pH_burned %>%
  group_by(Month_factor) %>%
  summarize(pH_MedianBurned=median(pH, na.rm=T))

pH_byMonth_control <- pH_control %>%
  group_by(Month_factor) %>%
  summarize(pH_MedianControl=median(pH, na.rm=T))

pH_byMonth <- merge(pH_byMonth_burned, pH_byMonth_control, by='Month_factor', all=T)
pH_byMonth <- pH_byMonth %>%
  mutate(Month_factor =  factor(Month_factor, levels = month_order)) %>%
  arrange(Month_factor)
pH_byMonth$pH_MedianDiff <- ((pH_byMonth$pH_MedianBurned - pH_byMonth$pH_MedianControl)/pH_byMonth$pH_MedianControl)*100

# basic plot
ggplot(pH_byMonth, aes(x=Month_factor, y=pH_MedianDiff))+
  geom_bar(stat='identity', fill='firebrick')+
  theme_classic()+
  scale_y_continuous('Percent difference',limits=common_y_limits, breaks=common_y_breaks)+
  scale_x_discrete('Month')+
  theme(axis.title.y=element_text(color='black'),
        axis.title.x=element_text(color='black'),
        axis.text.y=element_text(color='black'),
        axis.text.x=element_text(color='black'))+
  ggtitle('pH')+
  geom_hline(yintercept = 0, linetype='dashed')

## WaterTemp_C
WaterTemp_C <- waterquality[,c('WaterTemp_C','Month_factor','Type')]
WaterTemp_C_burned <- subset(WaterTemp_C, Type=='Burned')
WaterTemp_C_control <- subset(WaterTemp_C, Type=='Control')

WaterTemp_C_byMonth_burned <- WaterTemp_C_burned %>%
  group_by(Month_factor) %>%
  summarize(WaterTemp_C_MedianBurned=median(WaterTemp_C, na.rm=T))

WaterTemp_C_byMonth_control <- WaterTemp_C_control %>%
  group_by(Month_factor) %>%
  summarize(WaterTemp_C_MedianControl=median(WaterTemp_C, na.rm=T))

WaterTemp_C_byMonth <- merge(WaterTemp_C_byMonth_burned, WaterTemp_C_byMonth_control, by='Month_factor', all=T)
WaterTemp_C_byMonth <- WaterTemp_C_byMonth %>%
  mutate(Month_factor =  factor(Month_factor, levels = month_order)) %>%
  arrange(Month_factor)
WaterTemp_C_byMonth$WaterTemp_C_MedianDiff <- ((WaterTemp_C_byMonth$WaterTemp_C_MedianBurned - WaterTemp_C_byMonth$WaterTemp_C_MedianControl)/WaterTemp_C_byMonth$WaterTemp_C_MedianControl)*100

# basic plot
ggplot(WaterTemp_C_byMonth, aes(x=Month_factor, y=WaterTemp_C_MedianDiff))+
  geom_bar(stat='identity', fill='firebrick')+
  theme_classic()+
  scale_y_continuous('Percent difference',limits=common_y_limits, breaks=common_y_breaks)+
  scale_x_discrete('Month')+
  theme(axis.title.y=element_text(color='black'),
        axis.title.x=element_text(color='black'),
        axis.text.y=element_text(color='black'),
        axis.text.x=element_text(color='black'))+
  ggtitle('Water Temperature')+
  geom_hline(yintercept = 0, linetype='dashed')


## SpecCond_uScm
SpecCond_uScm <- waterquality[,c('SpecCond_uScm','Month_factor','Type')]
SpecCond_uScm_burned <- subset(SpecCond_uScm, Type=='Burned')
SpecCond_uScm_control <- subset(SpecCond_uScm, Type=='Control')

SpecCond_uScm_byMonth_burned <- SpecCond_uScm_burned %>%
  group_by(Month_factor) %>%
  summarize(SpecCond_uScm_MedianBurned=median(SpecCond_uScm, na.rm=T))

SpecCond_uScm_byMonth_control <- SpecCond_uScm_control %>%
  group_by(Month_factor) %>%
  summarize(SpecCond_uScm_MedianControl=median(SpecCond_uScm, na.rm=T))

SpecCond_uScm_byMonth <- merge(SpecCond_uScm_byMonth_burned, SpecCond_uScm_byMonth_control, by='Month_factor', all=T)
SpecCond_uScm_byMonth <- SpecCond_uScm_byMonth %>%
  mutate(Month_factor =  factor(Month_factor, levels = month_order)) %>%
  arrange(Month_factor)
SpecCond_uScm_byMonth$SpecCond_uScm_MedianDiff <- ((SpecCond_uScm_byMonth$SpecCond_uScm_MedianBurned - SpecCond_uScm_byMonth$SpecCond_uScm_MedianControl)/SpecCond_uScm_byMonth$SpecCond_uScm_MedianControl)*100

# basic plot
ggplot(SpecCond_uScm_byMonth, aes(x=Month_factor, y=SpecCond_uScm_MedianDiff))+
  geom_bar(stat='identity', fill='firebrick')+
  theme_classic()+
  scale_y_continuous('Percent difference',limits=common_y_limits, breaks=common_y_breaks)+
  scale_x_discrete('Month')+
  theme(axis.title.y=element_text(color='black'),
        axis.title.x=element_text(color='black'),
        axis.text.y=element_text(color='black'),
        axis.text.x=element_text(color='black'))+
  ggtitle('Specific conductivity')+
  geom_hline(yintercept = 0, linetype='dashed')


## ANC
ANC <- waterquality[,c('ANC_mgCaCO3L','Month_factor','Type')]
ANC_burned <- subset(ANC, Type=='Burned')
ANC_control <- subset(ANC, Type=='Control')

ANC_byMonth_burned <- ANC_burned %>%
  group_by(Month_factor) %>%
  summarize(ANC_MedianBurned=median(ANC_mgCaCO3L, na.rm=T))

ANC_byMonth_control <- ANC_control %>%
  group_by(Month_factor) %>%
  summarize(ANC_MedianControl=median(ANC_mgCaCO3L, na.rm=T))

ANC_byMonth <- merge(ANC_byMonth_burned, ANC_byMonth_control, by='Month_factor', all=T)
ANC_byMonth <- ANC_byMonth %>%
  mutate(Month_factor =  factor(Month_factor, levels = month_order)) %>%
  arrange(Month_factor)
ANC_byMonth$ANC_MedianDiff <- ((ANC_byMonth$ANC_MedianBurned - ANC_byMonth$ANC_MedianControl)/ANC_byMonth$ANC_MedianControl)*100

# basic plot
ggplot(ANC_byMonth, aes(x=Month_factor, y=ANC_MedianDiff))+
  geom_bar(stat='identity', fill='firebrick')+
  theme_classic()+
  scale_y_continuous('Percent difference',limits=common_y_limits, breaks=common_y_breaks)+
  scale_x_discrete('Month')+
  theme(axis.title.y=element_text(color='black'),
        axis.title.x=element_text(color='black'),
        axis.text.y=element_text(color='black'),
        axis.text.x=element_text(color='black'))+
  ggtitle('ANC mgCaCO3L')+
  geom_hline(yintercept = 0, linetype='dashed')




```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
