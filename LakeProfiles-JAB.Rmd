---
title: "RAPID Fire Project - Lake Profile Data"
date: "2022-10-03"
author: "J. Brentrup"
output: html_notebook
---

# Load Libraries
```{r, message=FALSE}
library(tidyverse)
library(googledrive)
library(readxl)
library(lubridate)
```

# Download profile data
- load data directly from google drive folder
```{r, message=FALSE}

# See what files are available
drive_find(q = "name contains 'Profiles'")

# Download Lake Profiles Round 1

# Use file ID
# drive_download(as_id("13qx6D_9t2AW55z2Oqkfna_zNLHowxvh_"),
#                path = "Data/Field Sampling_Lake Profiles_Round1.xlsx", 
#                overwrite = TRUE)

drive_download("Field Sampling_Lake Profiles_Round1.xlsx",
               path = "Data/WaterQuality/Field Sampling_Lake Profiles_Round1.xlsx", 
               overwrite = TRUE)

# Download Lake Profiles Round 2
drive_download("Field Sampling_Lake Profiles_Round2.xlsx",
               path = "Data/WaterQuality/Field Sampling_Lake Profiles_Round2.xlsx", 
               overwrite = TRUE)

```

# Load profile data
```{r}

profiles_may <- read_xlsx("Data/WaterQuality/Field Sampling_Lake Profiles_Round1.xlsx", sheet = 1, col_types = c(
  ID = "numeric",
  Site = "text",
  Date = "date",
  Field2 = "logical",
 `Profile Depth (m)` = "numeric",
 `Water Temp (°C)` = "numeric",
`Spec Cond (µS/cm)` = "numeric",
`LDO (mg/L)` = "numeric",
`LDO %` = "numeric",
pH = "numeric",
Field1 = "logical"
  
))

str(profiles_may)

profiles_june <- read_xlsx("Data/WaterQuality/Field Sampling_Lake Profiles_Round2.xlsx", sheet = 1, col_types = c(
  ID = "numeric",
  Site = "text",
  Date = "date",
  Field2 = "logical",
 `Profile Depth (m)` = "numeric",
 `Water Temp (°C)` = "numeric",
`Spec Cond (µS/cm)` = "numeric",
`LDO (mg/L)` = "numeric",
`LDO %` = "numeric",
pH = "numeric",
Field1 = "logical"
  
))

str(profiles_june)

```

# Load attribute data - stored on Github
```{r}
attribute_data <- read_csv("Data/attribute_data.csv")
spec(attribute_data)
```

# Download and load latest water quality data - through Aug. 2022
```{r}
drive_download("Lab Analyses_ Lakes9-30-22.xlsx",
               path = "Data/WaterQuality/Lab Analyses_ Lakes9-30-22.xlsx", 
               overwrite = TRUE)

wq_data <- read_xlsx("Data/WaterQuality/Lab Analyses_ Lakes9-30-22.xlsx")
# str(wq_data)

#May June July data with lake characteristics (burn vs. control)
wq_data_AE <- read_csv("Data/WaterQuality/may_june_july.csv")

str(wq_data_AE)

```


# Check May data
```{r}
summary(profiles_may)

# Total number of lakes - 29
unique(profiles_may$Site)

#Filter for lakes > 2m - 11 lakes

deep_lakes <- profiles_may %>% 
  filter(`Profile Depth (m)` > 2) %>% 
  count(Site)

```

# Plot May water temp profiles
```{r}

# Deepest lake - 4th McDougal
deep_lake <- profiles_may %>% 
  filter(Site == "Fourth McDougal")

ggplot(data = deep_lake, aes(x = `Water Temp (°C)`, y = `Profile Depth (m)`)) +
  scale_y_reverse()+
  scale_x_continuous(position = "top")+
  geom_point()+
  geom_path()

# Filter for deep lakes (profiles > 2 m)
deep_lakes_profiles <- profiles_may %>% 
   filter(Site %in% deep_lakes$Site)

ggplot(data = deep_lakes_profiles, aes(x = `Water Temp (°C)`, y = `Profile Depth (m)`, color = Site)) +
  scale_y_reverse()+
  scale_x_continuous(position = "top")+
  geom_point()+
  geom_path()+
  facet_wrap(~Site)

```

# Combine May and June data 
```{r}
profiles_all <- full_join(profiles_may, profiles_june) %>% 
  mutate(month = month(Date))
```

# Plot May & June water temp profiles
```{r}

# Deepest lake - 4th McDougal
deep_lake <- profiles_may %>% 
  filter(Site == "Fourth McDougal")

ggplot(data = deep_lake, aes(x = `Water Temp (°C)`, y = `Profile Depth (m)`)) +
  scale_y_reverse()+
  scale_x_continuous(position = "top")+
  geom_point()+
  geom_path()

# Filter for deep lakes (profiles > 2 m)
deep_lakes_profiles_all <- profiles_all %>% 
   filter(Site %in% deep_lakes$Site)

ggplot(data = deep_lakes_profiles_all, aes(x = `Water Temp (°C)`, y = `Profile Depth (m)`, color = factor(month))) +
  scale_y_reverse()+
  scale_x_continuous(position = "top")+
  geom_point()+
  geom_path()+
  facet_wrap(~Site)

```